# 短信同步转异步方案说明

1.转存的触发点  
1）触发了限流  
2）判断服务商崩溃，n次连续重试发送，依然失败。  

2.异步重发是放到单独的一个工作协程统一处理。可以设置时间间隔执行，设置短信有效时长，超时会从数据库删除不作发送。  

3.该容错机制优点是保证了短信不会丢失，在服务商可用的情况下必定能送达。适合短信较为重要，追求高成功发送率的场景。例如银行信用卡还款日期提醒，贷款返款日提醒，水电费提醒等等。  

4.该方案缺点，是在多实例的情况下，从数据库读取已存短信消息会有并发问题。解决办法是通过redis做转存，把读取和删除消息的步骤作为一个原子操作。 
