# 取topn点赞数的实现说明

实现接口文件在 internal->repository->cache->article_topn_cache.go  

测试文件是：article_topn_cache_test.go  

思路：在点赞的同时，记录新增的点赞数到本地缓存中，再批量刷新到redis的zset
1）避免对redis的频繁交互。    
2）减轻redis的存储和计算的压力，把它分散到各式实例中。  


细节：  
1.本地缓存使用map记录所有文章的点赞数，定时或手动调用Flush提交到redis      
2.提交时会遍历map，利用一个小堆heap，统计出前n个最多点赞数的文章，并批量提交到redis中，进行累计。     
3.GetTopN方法是从redis中进行获取的，在多实例的情况下数据的实时性会有一定的延后（缓存未提交部分）  
4.此方案上线时需要有另外的脚本把当前数据库文章的点赞数导入到redis中，脚本此作业中略过。  
5.此方案在突发事件导致程序终止时会有概率损失一些新增的点赞数（缓存未提交部分），可设置缓存自动提交时间减少损失。  

PS.因为出差的关系，没精力和时间做性能测试了。
